<!DOCTYPE html>
<html>
<head>
    <title>Manage Products</title>
</head>
<body>
<div>
    <h2>Manage Products</h2>
    <p id="welcome-msg"></p>

    <input type="text" id="product-name" placeholder="Product Name">
    <input type="number" id="product-price" placeholder="Price">
    <button onclick="addProduct()">Add Product</button>

    <table id="product-table">
        <thead>
            <tr><th>ID</th><th>Name</th><th>Price</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
const token = localStorage.getItem("token");
const user = JSON.parse(localStorage.getItem("user"));
if (!token || !user) window.location.href = "login.html";

document.getElementById("welcome-msg").innerText = `Hello, ${user.name} (${user.role})`;

// Get shop_id from URL
const shopId = new URLSearchParams(window.location.search).get("shop_id");

async function addProduct() {
    const name = document.getElementById("product-name").value;
    const price = Number(document.getElementById("product-price").value);

    const res = await fetch(`http://127.0.0.1:8000/products/add/${shopId}`, {
        method: "POST",
        headers: { 
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}` 
        },
        body: JSON.stringify({ name, price })
    });

    if (res.ok) {
        alert("Product added!");
        loadProducts();
    } else {
        const err = await res.json();
        alert(err.detail || "Error adding product");
    }
}

async function loadProducts() {
    const res = await fetch(`http://127.0.0.1:8000/products/${shopId}`, {
        headers: { "Authorization": `Bearer ${token}` }
    });
    const products = await res.json();
    const tbody = document.querySelector("#product-table tbody");
    tbody.innerHTML = "";
    products.forEach(p => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${p.id}</td>
            <td><input type="text" id="name-${p.id}" value="${p.name}"></td>
            <td><input type="number" id="price-${p.id}" value="${p.price}"></td>
            <td>
                <button onclick="updateProduct(${p.id})">Update</button>
                <button onclick="deleteProduct(${p.id})">Delete</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

async function updateProduct(id) {
    const name = document.getElementById(`name-${id}`).value;
    const price = Number(document.getElementById(`price-${id}`).value);

    const res = await fetch(`http://127.0.0.1:8000/products/${id}`, {
        method: "PUT",
        headers: { 
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}` 
        },
        body: JSON.stringify({ name, price })
    });

    if (res.ok) {
        alert("Product updated!");
        loadProducts();
    } else {
        const err = await res.json();
        alert(err.detail || "Error updating product");
    }
}

async function deleteProduct(id) {
    const res = await fetch(`http://127.0.0.1:8000/products/${id}`, {
        method: "DELETE",
        headers: { "Authorization": `Bearer ${token}` }
    });
    if (res.ok) {
        alert("Product deleted!");
        loadProducts();
    }
}

// Load products on page load
loadProducts();
</script>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>Manage Products</title>
</head>
<body>
<div>
    <h2>Manage Products</h2>
    <p id="welcome-msg"></p>

    <input type="text" id="product-name" placeholder="Product Name">
    <input type="number" id="product-price" placeholder="Price">
    <button onclick="addProduct()">Add Product</button>

    <table id="product-table">
        <thead>
            <tr><th>ID</th><th>Name</th><th>Price</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
const token = localStorage.getItem("token");
const user = JSON.parse(localStorage.getItem("user"));
if (!token || !user) window.location.href = "login.html";

document.getElementById("welcome-msg").innerText = `Hello, ${user.name} (${user.role})`;

// Get shop_id from URL
const shopId = new URLSearchParams(window.location.search).get("shop_id");

async function addProduct() {
    const name = document.getElementById("product-name").value;
    const price = Number(document.getElementById("product-price").value);

    const res = await fetch(`http://127.0.0.1:8000/products/add/${shopId}`, {
        method: "POST",
        headers: { 
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}` 
        },
        body: JSON.stringify({ name, price })
    });

    if (res.ok) {
        alert("Product added!");
        loadProducts();
    } else {
        const err = await res.json();
        alert(err.detail || "Error adding product");
    }
}

async function loadProducts() {
    const res = await fetch(`http://127.0.0.1:8000/products/${shopId}`, {
        headers: { "Authorization": `Bearer ${token}` }
    });
    const products = await res.json();
    const tbody = document.querySelector("#product-table tbody");
    tbody.innerHTML = "";
    products.forEach(p => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${p.id}</td>
            <td><input type="text" id="name-${p.id}" value="${p.name}"></td>
            <td><input type="number" id="price-${p.id}" value="${p.price}"></td>
            <td>
                <button onclick="updateProduct(${p.id})">Update</button>
                <button onclick="deleteProduct(${p.id})">Delete</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

async function updateProduct(id) {
    const name = document.getElementById(`name-${id}`).value;
    const price = Number(document.getElementById(`price-${id}`).value);

    const res = await fetch(`http://127.0.0.1:8000/products/${id}`, {
        method: "PUT",
        headers: { 
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}` 
        },
        body: JSON.stringify({ name, price })
    });

    if (res.ok) {
        alert("Product updated!");
        loadProducts();
    } else {
        const err = await res.json();
        alert(err.detail || "Error updating product");
    }
}

async function deleteProduct(id) {
    const res = await fetch(`http://127.0.0.1:8000/products/${id}`, {
        method: "DELETE",
        headers: { "Authorization": `Bearer ${token}` }
    });
    if (res.ok) {
        alert("Product deleted!");
        loadProducts();
    }
}

// Load products on page load
loadProducts();
</script>
</body>
</html>
